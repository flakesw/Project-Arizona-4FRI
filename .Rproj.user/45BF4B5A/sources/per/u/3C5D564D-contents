library("lme4")
library("effects")
library("MuMIn")
library("tidyverse")

plot_data <- read.csv("./Parameterization/Landis_TempSWA_Biomass_thornthwaiteMAX_Nov21.csv")
tree_data <- read.csv("./Parameterization/treedata_surv_covars.csv") %>%
  dplyr::filter(!is.na(Alive2)) %>%
  dplyr::select(c(treeID, plot, SPcode, Alive2, Age)) %>%
  left_join(plot_data, by = c("plot" = "plot")) %>%
  mutate(TEMPyrs7 = TEMPyrs7 + meanTEMP)


model <- glmer(Alive2 ~ Age + biomass +TEMPyrs7 + 
                 + SWAyrs8 +SWAmaxyrs3 + meanSWA.biomass + meanTEMP.biomass+
                 SWAyrs8.biomass + TEMPyrs7.biomass + (1|plot),
              data = tree_data,
              family = binomial(link = "logit"))

plot(allEffects(model))
AICc(model)
verification::roc.plot(x = tree_data$Alive2, pred = model@frame$Alive2)

summary(model)

MuMIn::r.squaredGLMM(model)

model <- glm(Alive2 ~ Age + biomass +TEMPyrs7 + 
                 + SWAyrs8,
               data = tree_data,
               family = binomial(link = "logit"))

plot(allEffects(model))
AICc(model)

summary(model)

MuMIn::r.squaredGLMM(model)
